<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crêpes-Dashboard</title>

    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

    <link rel="stylesheet" href="/static/css/global.css">
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <link rel="stylesheet" href="/static/css/header_style.css">

    <script src="/static/js/global.js"></script>
    <script src="/static/js/dashboard.js" defer></script>
    <script src="/static/js/handwritten/heatmapPlotter.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="load_sales();">
    <header>
        <h1>
            <span class="header-icon">dashboard</span>
            <p>Dashboard</p>
        </h1>
        <div class="header-nav-bar">
            <button type="button" class="crepe-button active"><a href="/">Kasse</a></button>
            <button type="button" class="crepe-button"><a href="/einstellungen">Einstellungen</a></button>
            <button type="button" class="crepe-button disabled" disabled><a href="#" disabled>Schichten</a></button>
        </div>
        <p id="clock"></p>
        <script>
            const clock = document.getElementById("clock");
            function alignClock() {
                var interval = setInterval(() => {
                    var secs = new Date().getUTCSeconds();
                    if (secs == 1) {
                        // console.log("First second!")
                        clearInterval(secs);
                        setInterval(setTime, 30_000) // Call setTime every 30 seconds
                    }
                }, 10)
            }
            function setTime() {
                // console.log("Clock test")
                var date = new Date();

                var hours = date.getHours();
                var mins = date.getMinutes();

                if (hours < 10) {
                    var hours = "0" + String(hours);
                }
                if (mins < 10) {
                    var mins = "0" + String(mins);
                }

                clock.innerText = `${hours}:${mins} Uhr`;
            }
            setTime()
            alignClock()
        </script>
    </header>


    <fieldset>
        <legend>
            <h2>Vergangene Verkäufe</h2>
        </legend>
        <table id="sales">
            <thead>
                <tr>
                    <th data-cell="TIME">Verkauft am</th>
                    <th data-cell="CrepeName">Crêpe</th>
                    <th data-cell="Amount">Anzahl</th>
                    <th data-cell="Price">Preis</th>
                </tr>
            </thead>
            <tbody id="sales-tbody">

            </tbody>
        </table>
        <h2 id="global-total">Gesamteinnahmen: <span>0€</span></h2><br>
        <h2>Uhrzeit Verteilung:</h2>
        <canvas id="salesHeatmap"></canvas>
    </fieldset>
</body>
</html>